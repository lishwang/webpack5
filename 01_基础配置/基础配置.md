[学习文档](http://xxpromise.gitee.io/webpack5-docs/base/css.html#_1-%E4%B8%8B%E8%BD%BD%E5%8C%85-2)

### webpack5的基础配置

##### 起步（通过控制台输入命令做webpack简单的打包，只能打包 js 和 json 文件）

1. 新建一个空文件夹；
2. 根目录创建 src 文件夹，src 内部创建 main.js 入口文件；
3. src 文件内创建 js 文件夹，内部创建两个 js 文件，并通过 import 与 export default 默认引入和导出到 main.js 入口文件；
4. `npm init -y `  初始化包管理工具；
5. `npm install -D webpack webpack-cli`  安装开发依赖 webpack；
6. 执行 `npx webpack ./src/main.js --mode=development`  使用 webpack 打包项目，打包后的文件路径为 `./dist/main.js` ；
7. 根目录创建 static 文件夹，内部创建 index.html 文件，并通过 script 引入打包后的文件路径即可执行；

##### webpack的配置文件

1. 在项目根目录下创建 `webpack.config.js` 文件；

   - **所有的配置文件都是在 nodejs 平台运行的，因此配置文件内部采用的模块化采用的都是 commonJs 的模块化（module.export={ xxx }）;**

2. 配置文件中的主要内容；

   - 入口

     - 打包的入口文件路径，一般是相对路径；

     ```
     module.export = {
     	entry: './src/main.js';
     }
     ```

   - 输出

     - 输出文件路径一般是绝对路径；
     - 输出属性值一般是一个对象；
     - **输出配置文件中设置 clean 为 true ，即可实现自动清空上次打包的内容**；但是在 webpack4 中需要在插件中实现；

     ```
     const path = require('path'); // nodejs模块，专门用来处理路径问题
     
     module.export = {
         output: {
             // 文件的输出路径（输出文件夹）
             path: path.resolve(__dirname, 'dist'), // path.resolve() 返回一个绝对路径；__dirname 当前文件的文件夹的目录；'dist' 输出的文件夹名称为 dist；
             // 输出文件名
             filename: 'main.js',
             // 自动清空上次打包的内容
         	clean: true,
         }
     }
     ```

   - 加载器

     - 处理样式资源

       - 下载loader

         - css-loader  负责将 Css 文件编译成 Webpack 能识别的模块（commonjs）到 js 中；
         - style-loader  会动态创建一个 Style 标签，里面放置 Webpack 中 Css 模块内容，并添加到 html 文件中使样式生效；

         ```
         npm i css-loader style-loader -D
         ```

       - 注意：loader 的执行顺序：从右到左（从下到上）

       - use的属性值是一个数组，可以使用多个 loader ；loader属性 的属性值是一个字符串，只能使用一个 loader ；

     ```
     module.export = {
     	module: {
     		rules: [
     			{
                     test: /\.css$/, // 检测css文件
                     // loader 的执行顺序：从右到左（从下到上）
                     use: [
                       'style-loader', // 将 js 中的css代码通过创建style标签添加到html文件中使样式生效；
                       'css-loader', // 将 css 资源编译成 commonjs 的模块到js 中；
                     ]
                 }
     		]
     	}
     }
     ```

     - 处理图片资源

       - 过去在 Webpack4 时，我们处理图片资源通过 `file-loader` 和 `url-loader` 进行处理，现在 Webpack5 已经将两个 Loader 功能内置到 Webpack 里了，我们只需要简单配置即可处理图片资源，不需要安装loader；
       - 另外，对于较小的图片可以将其转换成base64格式的字符串，减少浏览器请求，优化性能；
       - 可以设置生成的图片名字以及打包输出的图片所在的目录，做到**打包输出的文件归类放置**；

       ```
       module.export = {
       	module: {
       		rules: [
       			{
                       test: /\.(png|jpe?g|gif|webp)$/,
                       type: "asset",
                       parser: {
                         // 如果图片不大于100kb，将会被转化成base64格式的图片字符串
                         dataUrlCondition: {
                           maxSize: 100 * 1024 // 100kb
                         }
                       },
                       generator: {
                         // 设置生成的图片名字以及打包输出的图片所在的目录，做到打包输出的文件归类放置；
                         // hash 图片打包后会有一个唯一的id（图片默认情况下打包后的名字），这个id在webpack中被称为hash值；
                         // [hash:6] 表示取hash值的前六位最为图片的名字；
                         // ext 文件扩展名，之前是 .png 打包后 ext 还是 .png；
                         // query 查询参数，如果在url地址中写了其他参数，这里会携带上；
                         filename: 'static/images/[hash:6][ext][query]'
                       },
                   },
       		]
       	}
       }
       ```

       

     - 处理字体图标 以及 其他资源（不做资源内容的处理，原封不动的打包输出，例如音频、视频资源等）

       - 字体图标不需要转base64，因此配置属性 `type: "asset/resource"`  将文件原封不动的打包输出；

       ```
       module.export = {
       	module: {
       		rules: [
       			{
                       test: /\.(ttf|woff2?|mp3|mp4|avi)$/,
                       type: "asset/resource", // 将文件原封不动的打包输出
                       generator: {
                         // 设置打包输出的文件名字以及打包输出的文件所在的目录
                         filename: 'static/media/[hash:6][ext][query]'
                       },
                    },
       		]
       	}
       }
       ```

       

       - 

     - 

       

   - 插件

     - 

     ```
     module.export = {
         plugins: [
         	// 插件
         ]
     }
     ```

     

   - 模式

     - 模式有两种：development 和 production

     ```
     module.export = {
     	mode: 'development'
     }
     ```

     

3. 由于写了配置文件，因此可以直接执行 npx webpack  即可完成简单的打包；